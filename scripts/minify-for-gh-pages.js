#!/usr/bin/env node const fs = require('fs'); const path = require('path'); const inputDir = process.cwd(); const outDir = path.join(process.cwd(), 'dist'); function ensureDir(dir){ if(!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true }); } function minifyHtml(str){ str = str.replace(/<!--([\s\S]*?)-->/g, ''); str = str.replace(/>\s+</g, '><'); return str.trim(); } function minifyCss(str){ str = str.replace(/\/\*([\s\S]*?)\*\ str = str.replace(/\s+/g, ' '); str = str.replace(/\s*([{:;,}])\s*/g, '$1'); return str.trim(); } function minifyJs(str){ str = str.replace(/\/\*([\s\S]*?)\*\ str = str.replace(/\/\/.*$/gm, ''); str = str.replace(/\s+/g, ' '); return str.trim(); } function copyAndMinify(filePath, rel){ const ext = path.extname(filePath).toLowerCase(); const dest = path.join(outDir, rel); ensureDir(path.dirname(dest)); const content = fs.readFileSync(filePath, 'utf8'); let out = content; if(ext === '.html' || ext === '.htm') out = minifyHtml(content); else if(ext === '.css') out = minifyCss(content); else if(ext === '.js') out = minifyJs(content); fs.writeFileSync(dest, out, 'utf8'); } function walk(dir, base=''){ const items = fs.readdirSync(dir, { withFileTypes: true }); for(const it of items){ const full = path.join(dir, it.name); const rel = path.join(base, it.name); if(it.isDirectory()){ if(it.name === 'dist' || it.name === '.git') continue; walk(full, rel); } else { const ext = path.extname(it.name).toLowerCase(); if(['.html','.htm','.css','.js','.svg','.png','.jpg','.jpeg','.ico','json','txt'].includes(ext)){ copyAndMinify(full, rel); } else { const dest = path.join(outDir, rel); ensureDir(path.dirname(dest)); fs.copyFileSync(full, dest); } } } } ensureDir(outDir); walk(inputDir, ''); console.log('Wrote minified site to', outDir);